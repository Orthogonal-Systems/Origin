#!/usr/bin/env python

import sys
import os
fullBinPath=os.path.abspath(os.getcwd() + "/" + sys.argv[0])
fullLibPath=os.path.abspath(os.path.dirname(os.path.dirname(fullBinPath))+"/lib")
sys.path.append(fullLibPath)
import time
import zmq
import json

import origin
if len(sys.argv) > 1:
  configBundle = sys.argv[1]
  origin.configure(configBundle)
else:
  origin.configure("site")

from origin import current_time, timestamp, config

context = zmq.Context()
socket = context.socket(zmq.REQ)
host = config['origin_server']
port = config['origin_read_port']
socket.connect("tcp://%s:%s" % (host,port))

time.sleep(5)
raw=False

while True:
    print "sending read request...."
    start = int(time.time()) - 20 # 20 s of data
    request_obj = { 'stream': 'toy', 'field': 'toy1', 'raw': raw, 'start': start}
    socket.send(json.dumps(request_obj))
    response = socket.recv()
    print "sever responds with: "
    print response
    print 
    time.sleep(10)
    if raw:
        raw = False
    else:
        raw = True
